<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat28</title>
    <link rel="stylesheet" href="stylesheets/chat-style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css">
</head>

<body data-theme="light">
    <div class="drop-zone" id="dropZone">
        <i class="fa-solid fa-folder-open"></i>Drop files here to upload
    </div>

    <div class="navbar-top">
        <div class="page-title">Chat28</div>
        <div class="top-controls">
            <button class="profile-btn" onclick="showProfile()"><i class="fa-solid fa-user"></i> Profile</button>
            <button class="mode-toggle" onclick="toggleMode()"><i class="fa-solid fa-moon"></i> Dark Mode</button>
        </div>
    </div>

    <div class="chat-container">
        <div class="navbar">
            <div class="logo"><i class="fa-solid fa-comment"></i> Chat28</div>
            <div class="user-count">
                <i class="fa-solid fa-users"></i> Members Online
            </div>
            <div class="section-title">Online Members</div>
            <div class="tab-content" id="onlineUsers">
                <!-- WebSocket will populate users here -->
            </div>

            <div class="section-title" style="margin-top: 20px;">Offline Members</div>
            <div class="tab-content" id="offlineUsers">
                <!-- WebSocket populate users here -->
            </div>
        </div>

        <div class="main-chat">
            <div class="chat-header">
                <div>
                    <div class="chat-title">Public Channel</div>
                    <div class="chat-subtitle" id="chatSubtitle">0 total members • 0 online</div>
                </div>
                <div class="chat-actions">
                    <button class="action-btn" onclick="showChannelInfo()"><i class="fa-solid fa-circle-info"></i>
                        Info</button>
                </div>
            </div>

            <div class="message-container" id="messageContainer">
                <!-- Messages to be populated via WebSocket -->
            </div>

            <div class="message-input-container">
                <div class="message-type-selector">
                    <button class="type-btn active" onclick="setMessageType('public', this)">
                        <i class="fa-solid fa-globe"></i> Public
                    </button>
                    <button class="type-btn" onclick="setMessageType('private', this)">
                        <i class="fa-solid fa-lock"></i> Private
                    </button>
                </div>

                <div class="private-recipient-selector" id="recipientSelector">
                    <div class="recipient-label">Send private message to:</div>
                    <select class="recipient-select" id="recipientSelect">
                        <!-- WebSocket will populate  -->
                    </select>
                </div>

                <div class="input-wrapper">
                    <textarea class="message-input" id="messageInput" placeholder="Type your message..." rows="1"
                        onkeydown="handleKeyPress(event)" oninput="adjustHeight(this)"></textarea>
                    <div class="input-actions">
                        <input type="file" class="file-input" id="fileInput" multiple
                            onchange="handleFileSelect(event)">
                        <button class="input-btn" onclick="triggerFileInput()" title="Attach file">
                            <i class="fa-solid fa-paperclip"></i>
                        </button>
                        <button class="input-btn" onclick="addEmoji()" title="Add emoji">
                            <i class="fa-solid fa-smile"></i>
                        </button>
                        <button class="input-btn send-btn" onclick="sendMessage()" title="Send message">
                            <i class="fa-solid fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentMessageType = 'public';
        let dragCounter = 0;

        document.addEventListener('DOMContentLoaded', function () {
            const dropZone = document.getElementById('dropZone');
            const chatContainer = document.querySelector('.chat-container');

            chatContainer.addEventListener('dragenter', handleDragEnter);
            chatContainer.addEventListener('dragleave', handleDragLeave);
            chatContainer.addEventListener('dragover', handleDragOver);
            chatContainer.addEventListener('drop', handleDrop);

            document.getElementById('messageInput').focus();
        });

        function toggleMode() {
            const body = document.body;
            const modeBtn = document.querySelector('.mode-toggle');

            if (body.getAttribute('data-theme') === 'light') {
                body.setAttribute('data-theme', 'dark');
                modeBtn.innerHTML = '<i class="fa-solid fa-sun"></i> Light Mode';
            } else {
                body.setAttribute('data-theme', 'light');
                modeBtn.innerHTML = '<i class="fa-solid fa-moon"></i> Dark Mode';
            }
        }

        function showProfile() {
            // Placeholder for  integration
        }

        function showChannelInfo() {
            // Placeholder for integration
        }

        function setMessageType(type, btn) {
            currentMessageType = type;
            document.querySelectorAll('.type-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');

            const recipientSelector = document.getElementById('recipientSelector');
            if (type === 'private') {
                recipientSelector.classList.add('active');
            } else {
                recipientSelector.classList.remove('active');
            }
        }

        function startPrivateChat(userName) {
            const privateBtn = document.querySelector('.type-btn:nth-child(2)');
            setMessageType('private', privateBtn);
            const recipientSelect = document.getElementById('recipientSelect');
            recipientSelect.value = userName;
            document.getElementById('messageInput').focus();
        }

        // File handlers
        function handleDragEnter(e) { e.preventDefault(); dragCounter++; document.getElementById('dropZone').classList.add('active'); }
        function handleDragLeave(e) { e.preventDefault(); dragCounter--; if (dragCounter === 0) document.getElementById('dropZone').classList.remove('active'); }
        function handleDragOver(e) { e.preventDefault(); }
        function handleDrop(e) { e.preventDefault(); dragCounter = 0; document.getElementById('dropZone').classList.remove('active'); handleFiles(Array.from(e.dataTransfer.files)); }
        function triggerFileInput() { document.getElementById('fileInput').click(); }
        function handleFileSelect(event) { handleFiles(Array.from(event.target.files)); event.target.value = ''; }
        function handleFiles(files) {
            files.forEach(file => {
                displayFileMessage(file);
            });
        }

        function displayFileMessage(file) {
            const messagesContainer = document.getElementById('messageContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'my message';
            const messageTypeLabel = currentMessageType === 'private' ? 'Private' : 'Public';
            messageDiv.innerHTML = `
                <div class="message-content">
                    <div class="message-header">
                        <span class="message-sender">You</span>
                        <span>${messageTypeLabel}</span>
                    </div>
                    <div class="text">Shared a file: ${file.name}</div>
                    <div class="message-time">${new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</div>
                </div>
            `;
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function sendMessage() {
            const messageInput = document.getElementById('messageInput');
            const text = messageInput.value.trim();
            if (text === '') return;

            if (currentMessageType === 'private') {
                const recipient = document.getElementById('recipientSelect').value;
                if (!recipient) return; // Require recipient
            }

            const messagesContainer = document.getElementById('messageContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'my message';
            if (currentMessageType === 'private') messageDiv.classList.add('private-message');

            const messageTypeLabel = currentMessageType === 'private' ? 'Private' : 'Public';
            messageDiv.innerHTML = `
                <div class="message-content">
                    <div class="message-header">
                        <span class="message-sender">You</span>
                        <span>${messageTypeLabel}</span>
                    </div>
                    <div class="text">${text}</div>
                    <div class="message-time">${new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</div>
                </div>
            `;
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;

            messageInput.value = '';
            adjustHeight(messageInput);

            // Placeholder: send to WebSocket server here
        }

        function handleKeyPress(event) { if (event.key === 'Enter' && !event.shiftKey) { event.preventDefault(); sendMessage(); } }
        function adjustHeight(element) { element.style.height = 'auto'; element.style.height = element.scrollHeight + 'px'; }
        function addEmoji() { const messageInput = document.getElementById('messageInput'); const emojis = ['😊', '😄', '😍', '🤔', '👍', '👎', '❤️', '🔥', '💯', '🎉']; messageInput.value += emojis[Math.floor(Math.random() * emojis.length)]; messageInput.focus(); adjustHeight(messageInput); }
    </script>
</body>

</html>